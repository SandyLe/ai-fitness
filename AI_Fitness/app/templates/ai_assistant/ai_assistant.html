{% extends "main.html" %}

{% block title %}康训智能助手{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/ai_assistant.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome/css/all.min.css') }}">
{% endblock %}

{% block content %}
<div class="ai-assistant-container">
  <!-- 侧边栏 - 历史记录 -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>历史对话</h2>
    </div>
    <div class="history-list" id="historyList">
      <!-- 历史记录将通过JS动态添加 -->
    </div>
  </div>

  <!-- 主聊天区域 -->
  <div class="chat-area">
    <div class="chat-header">
      <h2>康训智能助手</h2>
       <button id="add_to_plan_button" class="plan-button" title="将当前对话添加到我的计划">
        <i class="fas fa-calendar-plus"></i> 添加到我的计划
      </button>
      <div id="addPlanModal" class="modal-overlay">
        <div class="modal-content">
          <div class="modal-header">
            <h3>请给计划起个名吧</h3>
          </div>
          <div class="modal-body">
            <div class="modal-input">
              <label for="planTitle">计划名称：</label>
              <input type="text" name="text" id="planTitle" placeholder="请输入计划名称" />
              <input type="date" id="startDate" name="startPlanDate" placeholder="请输入开始训练日期">
            </div>
            <div class="modal-box-input">
              <div>
                 <label for="monday-content">周一：</label>
                 <input type="text" name="text" id="monday-time" placeholder="计划时间" disabled />
                 <input type="text" name="text" id="monday-title" placeholder="计划名字" />
                 <div id="monday-content">
                  <textarea name="text" id="monday-content-text" placeholder="输入计划内容"></textarea>
                 </div>
              </div>
              <div>
                 <label for="tuesday-content">周二：</label>
                 <input type="text" name="text" id="tuesday-time" placeholder="计划时间" disabled />
                 <input type="text" name="text" id="tuesday-title" placeholder="计划名字" />
                 <div id="tuesday-content">
                  <textarea name="text" id="tuesday-content-text" placeholder="输入计划内容"></textarea>
                 </div>
              </div>
              <div>
                 <label for="wednesday-content">周三：</label>
                 <input type="text" name="text" id="wednesday-time" placeholder="计划时间" disabled />
                 <input type="text" name="text" id="wednesday-title" placeholder="计划名字" />
                 <div id="wednesday-content">
                  <textarea name="text" id="wednesday-content-text" placeholder="输入计划内容"></textarea>
                 </div>
              </div>
              <div>
                 <label for="thursday-content">周四：</label>
                 <input type="text" name="text" id="thursday-time" placeholder="计划时间" disabled />
                 <input type="text" name="text" id="thursday-title" placeholder="计划名字" />
                 <div id="thursday-content">
                  <textarea name="text" id="thursday-content-text" placeholder="输入计划内容"></textarea>
                 </div>
              </div>
              <div>
                 <label for="friday-content">周五：</label>
                 <input type="text" name="text" id="friday-time" placeholder="计划时间" disabled />
                 <input type="text" name="text" id="friday-title" placeholder="计划名字" />
                 <div id="friday-content">
                  <textarea name="text" id="friday-content-text" placeholder="输入计划内容"></textarea>
                 </div>
              </div>
              <div>
                 <label for="saturday-content">周六：</label>
                 <input type="text" name="text" id="saturday-time" placeholder="计划时间" disabled />
                 <input type="text" name="text" id="saturday-title" placeholder="计划名字" />
                 <div id="saturday-content">
                  <textarea name="text" id="saturday-content-text" placeholder="输入计划内容"></textarea>
                 </div>
              </div>
              <div>
                 <label for="sunday-content">周日：</label>
                 <input type="text" name="text" id="sunday-time" placeholder="计划时间" disabled />
                 <input type="text" name="text" id="sunday-title" placeholder="计划名字" />
                 <div id="sunday-content">
                  <textarea name="text" id="sunday-content-text" placeholder="输入计划内容"></textarea>
                 </div>
              </div>
            </div>
           
          </div>
          <div class="modal-footer">
            <button type="button" id="confirmAddPlan" class="btn btn-primary">确认添加计划</button>
            <button type="button" id="cancelAddPlan" class="btn btn-danger">取消</button>
          </div>
        </div>
      </div>
    </div>
    <!-- 欢迎消息部分 -->
    <div class="conversation" id="conversation">
      <!-- 欢迎消息将在JS中动态添加 -->
    </div>
    
    <div class="loading" id="loading">
      正在思考中<span class="dots"></span>
    </div>
    
    <!-- 快捷提示区域 -->
    <div class="quick-prompts">
      <div class="prompt-chip" data-prompt="帮我制定一个减脂训练计划">减脂训练计划</div>
      <div class="prompt-chip" data-prompt="如何增肌？">增肌指南</div>
      <div class="prompt-chip" data-prompt="推荐一些适合初学者的康训动作">初学者动作</div>
      <div class="prompt-chip" data-prompt="健康饮食有哪些原则？">健康饮食</div>
    </div>
    
    <!-- 输入区域 -->
    <div class="input-area">
      <div class="input-container">
        <textarea class="input-field" id="input_text" placeholder="输入你的问题..." rows="1"></textarea>
        <button class="send-button" id="send_button">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- 隐藏的用户ID字段 -->
<input type="hidden" id="userid" value="{{ user.user_id|default('0') }}">

{% endblock %}

{% block extra_js %}
<link rel="stylesheet" href="{{ url_for('static', filename='dialog/dialog.css') }}">>
<script src="https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js"></script>
<script src="{{ url_for('static', filename='dialog/dialog.js') }}"></script>
<script src="{{ url_for('static', filename='js/ai_assistant.js') }}"></script>
{% endblock %}
