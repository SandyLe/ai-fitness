// jQuery核心功能
(function(global, factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        module.exports = global.document ? 
            factory(global, true) : 
            function(w) {
                if (!w.document) {
                    throw new Error("jQuery requires a window with a document");
                }
                return factory(w);
            };
    } else {
        factory(global);
    }
}(typeof window !== "undefined" ? window : this, function(window, noGlobal) {
    // ... jQuery核心代码 ...
}));

// 页面初始化
$(document).ready(function() {
    // 性别选择处理
    $('#sexchoosermale').on('change', function() {
        $('#femalefigures').hide();
        $('#malefigures').show();
        
        // 更新性别按钮选中状态
        $('#sexchoosermalelabel').addClass('active');
        $('#sexchooserfemalelabel').removeClass('active');
    });
    
    $('#sexchooserfemale').on('change', function() {
        $('#malefigures').hide();
        $('#femalefigures').show();
        
        // 更新性别按钮选中状态
        $('#sexchooserfemalelabel').addClass('active');
        $('#sexchoosermalelabel').removeClass('active');
    });

    // 默认显示男性图并设置选中状态
    $('#malefigures').show();
    $('#femalefigures').hide();
    
    // 根据localStorage设置初始选中状态
    var _sex = localStorage.getItem("sex") || "m";
    if (_sex === "m") {
        $('#sexchoosermalelabel').addClass('active');
        $('#sexchooserfemalelabel').removeClass('active');
    } else {
        $('#sexchooserfemalelabel').addClass('active');
        $('#sexchoosermalelabel').removeClass('active');
    }

    // 锻炼方式按钮点击处理
    $('.section-button').on('click', function() {
        $('.section-button').removeClass('active');
        $('.section-button').removeClass('section-selected');
        $(this).addClass('active');
        $(this).addClass('section-selected');
    });

    // 初始化图片延迟加载
    var lazyLoadInstance = new LazyLoad({
        elements_selector: "img", // 对所有img标签启用延迟加载
        threshold: 300, // 提前300px开始加载
        callback_loaded: function(el) {
            // 图片加载完成后的回调
            el.classList.add('loaded');
        }
    });
});

// LazyLoad图片延迟加载功能
!function(t,e) {
    "object"==typeof exports ? module.exports = e(t) : 
    "function"==typeof define && define.amd ? define([],e) : 
    t.LazyLoad = e(t)
}("undefined"!=typeof global ? global : this.window || this.global, function(t) {
    "use strict";
    
    function e(t,e) {
        this.settings = s(r,e||{});
        this.images = t || document.querySelectorAll(this.settings.selector);
        this.observer = null;
        this.init();
    }
    
    const r = {
        src: "data-src",
        srcset: "data-srcset",
        selector: "img", // 修改为img,对所有图片生效
        root: null,
        rootMargin: "0px",
        threshold: 0
    };

    // LazyLoad核心方法
    e.prototype = {
        init: function() {
            if (!t.IntersectionObserver) return void this.loadImages();
            
            let e = this,
                r = {
                    root: this.settings.root,
                    rootMargin: this.settings.rootMargin,
                    threshold: [this.settings.threshold]
                };
            
            this.observer = new IntersectionObserver(function(t) {
                Array.prototype.forEach.call(t, function(t) {
                    if (t.isIntersecting) {
                        e.observer.unobserve(t.target);
                        let r = t.target.getAttribute(e.settings.src),
                            s = t.target.getAttribute(e.settings.srcset);
                        
                        if ("img" === t.target.tagName.toLowerCase()) {
                            r && (t.target.src = r);
                            s && (t.target.srcset = s);
                        } else {
                            t.target.style.backgroundImage = "url(" + r + ")";
                        }
                    }
                });
            }, r);

            Array.prototype.forEach.call(this.images, function(t) {
                e.observer.observe(t);
            });
        },

        loadImages: function() {
            if (!this.settings) return;
            
            let t = this;
            Array.prototype.forEach.call(this.images, function(e) {
                let r = e.getAttribute(t.settings.src),
                    s = e.getAttribute(t.settings.srcset);
                
                if ("img" === e.tagName.toLowerCase()) {
                    r && (e.src = r);
                    s && (e.srcset = s);
                } else {
                    e.style.backgroundImage = "url('" + r + "')";
                }
            });
        }
    };

    return e;
});

